version: '3.8'

services:
  ollama:
    image: ollama/ollama:0.1.32
    container_name: myantfarm_ollama
    ports:
      - "11434:11434"
    volumes:
      - ollama_models:/root/.ollama
    networks:
      - myantfarm_network

  copilot:
    build:
      context: ./services/copilot
    container_name: myantfarm_copilot
    ports:
      - "8001:8000"
    environment:
      - OLLAMA_URL=http://ollama:11434
      - MODEL_NAME=tinyllama
      - TEMPERATURE=0.7
      - MAX_TOKENS=512
    depends_on:
      - ollama
    networks:
      - myantfarm_network

  multiagent:
    build:
      context: ./services/multiagent
    container_name: myantfarm_multiagent
    ports:
      - "8002:8000"
    environment:
      - OLLAMA_URL=http://ollama:11434
      - MODEL_NAME=tinyllama
      - TEMPERATURE=0.7
      - MAX_TOKENS=512
    depends_on:
      - ollama
    networks:
      - myantfarm_network

  evaluator:
    build:
      context: ./services/evaluator
    container_name: myantfarm_evaluator
    environment:
      - COPILOT_URL=http://copilot:8000
      - MULTIAGENT_URL=http://multiagent:8000
      - TRIALS_PER_CONDITION=116
      - RANDOM_SEED=42
      - RESULTS_DIR=/app/results
    depends_on:
      - copilot
      - multiagent
    volumes:
      - ./results:/app/results
    networks:
      - myantfarm_network
    command: tail -f /dev/null

  analyzer:
    build:
      context: ./services/analyzer
    container_name: myantfarm_analyzer
    environment:
      - RESULTS_DIR=/app/results
    volumes:
      - ./results:/app/results
    networks:
      - myantfarm_network

volumes:
  ollama_models:

networks:
  myantfarm_network:
    driver: bridge
